<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search African Foodways Archive</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background: #fafafa; }
        h1 { color: #2c3e50; border-bottom: 2px solid #e67e22; padding-bottom: 10px; }
        input { width: 100%; padding: 12px; font-size: 16px; border: 2px solid #ddd; border-radius: 6px; margin: 20px 0; }
        input:focus { outline: none; border-color: #e67e22; }
        .results { margin-top: 20px; }
        .entry { background: white; padding: 15px; margin-bottom: 10px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .entry a { font-size: 18px; color: #e67e22; text-decoration: none; font-weight: bold; }
        .entry a:hover { text-decoration: underline; }
        .meta { color: #666; font-size: 14px; margin-top: 5px; }
        .count { background: #e67e22; color: white; padding: 4px 10px; border-radius: 20px; font-size: 14px; display: inline-block; }
        .footer { margin-top: 40px; font-size: 14px; color: #999; text-align: center; }
    </style>
</head>
<body>
    <h1>African Foodways Archive</h1>
    <p>Search sensory records, techniques, ingredients, and case studies.</p>
    <input type="text" id="search" placeholder="Search by keyword (e.g., shea, cerasee, ash, sensory)..." autofocus>
    <div class="results" id="results"></div>
    <div class="footer">
        Archive by Ivy Newton ¬∑ <a href="https://chicafricanculture.github.io/african-foodways-data/">Browse full index</a> ¬∑ CC BY 4.0
    </div>

    <script>
        let archiveData = null;
        
        // Load the index
        fetch('index.json')
            .then(r => r.json())
            .then(data => {
                archiveData = data;
                // If there's a search term in URL, use it
                const urlParams = new URLSearchParams(window.location.search);
                const term = urlParams.get('q');
                if (term) {
                    document.getElementById('search').value = term;
                    search(term);
                }
            });
        
        document.getElementById('search').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            // Update URL without reloading
            const url = new URL(window.location);
            if (term) url.searchParams.set('q', term);
            else url.searchParams.delete('q');
            window.history.replaceState({}, '', url);
            search(term);
        });
        
        function search(term) {
            if (!archiveData || !term) {
                document.getElementById('results').innerHTML = '';
                return;
            }
            
            const results = [];
            
            archiveData.collections.forEach(collection => {
                collection.files.forEach(file => {
                    // Simple text search on title and filename
                    if (file.title.toLowerCase().includes(term) || 
                        file.filename.toLowerCase().includes(term)) {
                        results.push({
                            title: file.title,
                            collection: collection.name,
                            url: `${collection.path}${file.filename}`,
                            filename: file.filename
                        });
                    }
                });
            });
            
            if (results.length === 0) {
                document.getElementById('results').innerHTML = '<p>No entries found. Try another keyword.</p>';
                return;
            }
            
            let html = `<p><span class="count">${results.length}</span> entries found</p>`;
            
            results.forEach(r => {
                html += `
                    <div class="entry">
                        <a href="${r.url}" target="_blank">${r.title}</a>
                        <div class="meta">
                            üìÅ ${r.collection} ¬∑ üìÑ ${r.filename}
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('results').innerHTML = html;
        }
    </script>
</body>
</html>
